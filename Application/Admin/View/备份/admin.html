<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="renderer" content="webkit">

    <title>后台管理系统</title>
    <link href="__PUBLIC__/admin/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/animate.css" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="__PUBLIC__/admin/css/style.css?v=2.2.0" rel="stylesheet">
    
    <style type="text/css">
        html{overflow-y: auto;}
        .red{color: red;font-weight: bold;}
        .green{color: green;font-weight: bold;}
        .orange{color: orange;font-weight: bold;}

        table{font-size: 12px;}

        .modify{display: none; width: 100%;background:rgba(0,0,0,0.8);position: absolute;left: 0;top: 0;z-index: 100;font-weight: bold;display: none;height: 100%;}
        .btnbox{width: 100%;text-align: center;}
        .xy50{position: absolute;left: 50%;top: 50%;-webkit-transform:translate(-50%,-50%); }
        .inputbox{width: 500px;margin: 0 auto;color: #CCCCCC;padding: 50px 0;}
        .inputbox input, select{color: #000000;}
        .btnbox button{width: 30%;display: inline-block;margin: 0 45px;padding: 5px;background-color: #1ab394;color: #FFFFFF;}
        .auditbox{width: 100%;height: 100%;position: absolute;left: 0;top: 0;z-index: 9;background:rgba(0,0,0,0.8);font-size: 18px;display: none;}
        .auditbox >div{width: 500px;margin: 0 auto;padding:20px;background: #ffffff;border-radius: 5px;}
        .checkbox{display: inline-block;pointer-events: none;}
        .send_btn,.cancel_btn{font-size: 18px;display: block;margin: 10px;}

        .imgs{cursor: pointer;}
        .big-img-box{width: 500px;position: fixed;left: 0;bottom: 0;z-index: 10;cursor: pointer;}
        .big-img-box img{width: 100%;}

        .loadings{ position: absolute; width: 100%;  height: 100%;  left: 0;  top: 0; background: rgba(0,0,0,0.8);  z-index: 3000;display: none; }
        .loadings div{width: 180px; height: 180px; position: absolute; left: 50%; top: 50%; margin: -90px 0 0 -90px;background: url(__PUBLIC__/img/loading.png) no-repeat center center; background-size: contain; -webkit-animation: rotate 2s linear 0s infinite;}
        @-webkit-keyframes rotate {
            0% { -webkit-transform: rotate(0deg);}
            100% {   -webkit-transform: rotate(359deg);}
        }
    </style>
</head>

<body>
<div id="wrapper">
    <include file="./Public/left" />
    <div id="page-wrapper" class="gray-bg dashbard-1">
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-sm-4">
                <h2>审核列表</h2>
                <!--<ol class="breadcrumb">-->
                    <!--<li><a href="__ROOT__/index.php?s=admin&a=admin">主页</a></li>-->
                    <!--<li><strong>审核列表</strong></li>-->
                <!--</ol>-->
            </div>
        </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>注册信息</h5>
                            <h5>&nbsp;&nbsp;&nbsp;&nbsp;<a href="?s=admin&a=excel" class="excel">下载Excel</a></h5>
                            <!--<h5>&nbsp;&nbsp;&nbsp;&nbsp;<a href="?s=admin&a=download" class="excel">下载图片</a></h5>-->
                            <form method="get" action="">
                                <input type="hidden" name="s" value="admin">
                                <input type="hidden" name="a" value="admin">
                                <div style="float: right;">
                                    选择审核状态：
                                    <select name="state">
                                        <option value="NO"  <if condition="$Think.get.state eq 'NO'">selected="selected"</if> >请选择</option>
                                        <option value="0" <if condition="$Think.get.state eq '0'">selected="selected"</if> >未审核</option>
                                        <option value="1" <if condition="$Think.get.state eq 1">selected="selected"</if> >已通过</option>
                                        <option value="2" <if condition="$Think.get.state eq 2">selected="selected"</if> >未通过</option>
                                        <option value="4" <if condition="$Think.get.state eq 4">selected="selected"</if> >重新填写</option>
                                    </select>
                                    输入姓名：
                                    <input type="text" name="key" value="{$Think.get.key}" />
                                    <button type="submit" style="margin-left: 10px;">搜索</button>
                                </div>
                            </form>
                        </div>
                        <div class="ibox-content">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th>编号</th>
                                    <th>预约时间</th>
                                    <th>用户名</th>
                                    <th>图片</th>
                                    <th>序列号</th>
                                    <th>联系方式</th>
                                    <th width="150">活动类型</th>
                                    <th>经销商</th>
                                    <th>参加日期</th>
                                    <th>预约码</th>

                                    <th>审核日期</th>
                                    <th>审核结果</th>
                                    <th width="150">不通过原因</th>
                                    <th>备注</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <volist id="list" name="list" >
                                        <tr <switch name="list.end_result" >
                                        <case value="4">class="orange"</case>
                                        <case value="1">class="green"</case>
                                        <case value="2">class="red"</case>
                                        <default />
                                    </switch>>
                                            <th>{$list['id']}</th>
                                            <td>{$list['add_time']}</td>
                                            <td>{$list['name']}</td>
                                            <td><img src= "Public/uploads/{$list['img']}" class="imgs" width="150"></td>
                                            <td>{$list['data']}</td>
                                            <td>{$list['tel']}</td>
                                            <td  width="150">{$list['type']}</td>
                                            <td>{$list['dealer']}</td>
                                            <td>{$list['time']}</td>
                                            <td>{$list['code']}</td>

                                            <td>{$list['review']}</td>
                                            <td>
                                                <switch name="list.end_result" >
                                                    <case value="0">
                                                        <span class="red">待审核</span>
                                                        <div><button class="green audit_btn1" data-num="{$list['id']}" data-tel="{$list['tel']}">审核通过</button></div>
                                                        <div><button class="green audit_btn2" data-num="{$list['id']}" data-tel="{$list['tel']}">审核不过</button></div>
                                                    </case>
                                                    <case value="1"><span class="green">通过</span></case>
                                                    <case value="2"><span class="red">不通过</span></case>
                                                    <case value="4">
                                                        <span class="red">待审核</span>
                                                        <div><button class="green audit_btn1" data-num="{$list['id']}" data-tel="{$list['tel']}">审核通过</button></div>
                                                        <div><button class="green audit_btn2" data-num="{$list['id']}" data-tel="{$list['tel']}">审核不过</button></div>
                                                    </case>
                                                    <default />
                                                </switch>

                                            </td>
                                            <td  width="150">{$list['error_text']}</td>
                                            <td>{$list['note']}</td>
                                            <td><button class="modify_btn" data-num="{$list['id']}">修改</button></td>
                                        </tr>
                                    </volist>
                                </tbody>
                            </table>
                            <div style="text-align: center">{$page}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <div class="modify ">
        <input type="hidden" class="numsid" style="display: none;">
        <div class="inputbox ">
            <div class="form-group">
                <span>预约时间</span>
                <input type="text" class="form-control add_time">
            </div>
            <div class="form-group">
                <span class="red">用户名</span>
                <input type="text" class="form-control name">
            </div>
            <div class="form-group">
                <span class="red">序列号</span>
                <input type="text" class="form-control data">
            </div>
            <div class="form-group">
                <span class="red">联系方式</span>
                <input type="tel" class="form-control tel">
            </div>
            <div class="form-group">
                <span class="red">活动类型</span>
                <select style="width: 100%;padding: 8px 12px;font-size: 14px;" class="type">
                    <option value="豪华套餐：买35套赠15套耗材享8折加购助针器">豪华套餐：买35套赠15套耗材享8折加购助针器</option>
                    <option value="精致套餐：买35套赠15套耗材">精致套餐：买35套赠15套耗材</option>
                </select>
            </div>
            <div class="form-group">
                <span>经销商</span>
                <input type="text" class="form-control dealer">
            </div>
            <div class="form-group">
                <span>参加日期</span>
                <input type="text" class="form-control time">
            </div>
            <div class="form-group">
                <span>审核日期</span>
                <input type="text" class="form-control review">
            </div>
            <div class="form-group">
                <span>审核结果（“0”待审核，“1”通过，“2”不通过）</span>
                <input type="text" class="form-control end_result">
            </div>
            <div class="form-group">
                <span>备注</span>
                <input type="text" class="form-control note">
            </div>
            <div class="btnbox">
                <button style="background: #CCCCCC;" data-num="1">取消</button>
                <button data-num="2">保存</button>
            </div>
        </div>
    </div>
    <div class="auditbox">
        <input type="hidden" class="cont_id" style="display: none;">
        <input type="hidden" class="tel" style="display: none;">
        <div class="not_through xy50">
            <div class="form-group">
                <p>请选择短信内容</p>
                <div>
                    <input type="checkbox" id="A1"  name="content" class="checkbox" value="用户名与档案中不符" /><label for="A1"><span class="inputval">用户名与档案中不符</span></label>
                </div>
                <div>
                    <input type="checkbox" id="A2"  name="content" class="checkbox" value="用户泵号与档案中不符" /><label for="A2"><span class="inputval">用户泵号与档案中不符</span></label>
                </div>
                <div>
                    <input type="checkbox" id="A3"  name="content" class="checkbox" value="用户档案中无用户信息" /><label for="A3"><span class="inputval">用户档案中无用户信息</span></label>
                </div>
                <div>
                    <input type="checkbox" id="A4"  name="content" class="checkbox" value="泵照片泵号不清晰" /><label for="A4"><span class="inputval">泵照片泵号不清晰</span></label>
                </div>
                <div>
                    <input type="checkbox" id="A5"  name="content" class="checkbox" value="A5" /><label for="A5"><span class="addcheck">其他</span></label>
                    <input type="text" class="form-control inputs" style="display:none;">
                </div>
                <div>
                    <button class="btn btn-sm btn-primary pull-left m-t-n-xs cancel_btn" ><strong>取消</strong> </button>
                    <button class="btn btn-sm btn-primary pull-left m-t-n-xs send_btn" ><strong>发送短信</strong> </button>
                </div>
            </div>
        </div>
    </div>
<div class="loadings"><div></div></div>
<div class="big-img-box">
    <img src="">
</div>

<!-- Mainly scripts -->
<script src="__PUBLIC__/admin/js/jquery-2.1.1.min.js"></script>
<script src="__PUBLIC__/admin/js/bootstrap.min.js?v=3.4.0"></script>
<script src="__PUBLIC__/admin/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="__PUBLIC__/admin/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="__PUBLIC__/js/jquery.cookie.js"></script>
<!-- Custom and plugin javascript -->
<script src="__PUBLIC__/admin/js/hplus.js?v=2.2.0"></script>
<script src="__PUBLIC__/admin/js/plugins/pace/pace.min.js"></script>
<script src="__PUBLIC__/admin/js/plugins/sweetalert/sweetalert.min.js"></script>
<script src="__PUBLIC__/admin/js/plugins/iCheck/icheck.min.js"></script>
<script src="__PUBLIC__/admin/js/plugins/datapicker/bootstrap-datepicker.js"></script>

<script>
    $(".imgs").click(function(){
        $(".big-img-box img").attr("src",$(this).attr("src"));
        $(".big-img-box").fadeIn();
    });
    $(".big-img-box").click(function(){
        $(".big-img-box").fadeOut();
    });

    $(".modify_btn").on("click",function () {
    $(".modify").fadeIn();
    var numid=$(this).data("num");
        $.post("?s=admin&a=modify", {
            numid:numid
        }, function (e) {
            $(".numsid").val(numid);
            $(".add_time").val(e.code.add_time);
            $(".name").val(e.code.name);
            $(".data").val(e.code.data);
            $(".tel").val(e.code.tel);
            $(".type option[value="+e.code.type+"]").attr("selected",true).siblings().attr("selected",false);
            $(".dealer").val(e.code.dealer);
            $(".time").val(e.code.time);
            $(".review").val(e.code.review);
            $(".end_result").val(e.code.end_result);
            $(".note").val(e.code.note);
//			console.log(e);
        }, "json");
    });

    $(".btnbox button").on("click",function () {
       var nums = $(this).data("num");
        switch (nums){
            case 1:
                $(".modify").fadeOut();
                break;
            case 2:
                var id = $(".numsid").val();
                var add_time = $(".add_time").val();
                var names = $(".name").val();
                var datas = $(".data").val();
                var tels = $(".tel").val();
                var types = $(".type").val();
                var dealer = $(".dealer").val();
                var times = $(".time").val();
                var text_result = $(".text_result").val();
                var review = $(".review").val();
                var end_result = $(".end_result").val();
                var notes = $(".note").val();
//                if(!id || !add_time || !names || !tels || !types || !dealer || !times || !codes || !text_result || !review || !end_result || !notes){
//                    alert("请完善信息哦！");
//                    return false;
//                }
                $(".loadings").show();
                $.post("?s=admin&a=update", {
                    id:id, add_time:add_time,name:names,data:datas,tel:tels,type:types, dealer:dealer,
                    time:times, text_result:text_result,review:review,end_result:end_result,note:notes,
                }, function (e) {
                    console.log(e);
                    $(".loadings").hide();
                    if(e.code==1){
                        alert("修改成功！");
//                        window.location = "?s=admin&a=admin";
                        location.reload();
                    }else {
                        alert("提交失败，请稍后尝试！");
                    }
               }, "json");
                break;
        }

    });
       //审核通过发送短信
    $(".audit_btn1").click(function() {
        var numid=$(this).data("num");
        var tel=$(this).data("tel");
        if(confirm("是否确定审核通过")) {
            $.post("?s=admin&a=audit&param=1", {
                id:numid,
                tel:tel
            }, function (e) {
                console.log(e);
                if(e.code==1){
                    alert("审核通过短信已发送");
//                    window.location = "?s=admin&a=admin";
                    location.reload();
                }
            }, "json");

        } else {
            return false;
        }
    });
    //审核不通过发送短信
    $(".audit_btn2").click(function() {
        var numid=$(this).data("num");
        $(".tel").val($(this).data("tel"));
        $(".cont_id").val(numid);
        $(".auditbox").fadeIn();
    });

    $(".addcheck").click(function() {
        var vala=[];
        $('input[name="content"]:checked').each(function() {
            vala.push($(this).val());
        });
        if(vala.indexOf("A5") >= 0){
            $(".inputs").hide();
        }else {
            $(".inputs").fadeIn();
        }
    });

    $(".send_btn").on("click",function () {
        var ids= $(".cont_id").val();
        var tel= $(".tel").val();
        var vala=[],content,other;
        $('input[name="content"]:checked').each(function() {
            vala.push($(this).val());
        });
        if(vala.indexOf("A5") >= 0) {
            other=$(".inputs").val();
            vala.pop();
            vala.push(other);
            if($(".inputs").val()==""){
                alert("请填写其他的具体原因！");
                return false;
            }
        }
        content=vala.join(",");
        if(!content){
            alert("请选择需要发送的内容");
            return false;
        }
        content=vala.join(",");
        $.post("?s=admin&a=audit&param=2", {
            id:ids,
            tel:tel,
            content:content
        }, function (e) {
            console.log(e);
            if(e.code==1){
                alert("审核未通过短信已发送");
//                window.location = "?s=admin&a=admin";
                location.reload();
            }
        }, "json");
//        console.log(content);
    });

    $(".cancel_btn").on("click",function () {
        $(".auditbox").fadeOut();
    });




    function getScrollTop(){
        var scrollTop=0;
        if(document.documentElement&&document.documentElement.scrollTop){
            scrollTop=document.documentElement.scrollTop;
        }else if(document.body){
            scrollTop=document.body.scrollTop;
        }
        return scrollTop;
    }



    $("body").scroll(function() {
        $.cookie('tops', getScrollTop(), { expires: 1 });
    });

    if($.cookie('tops')){
        $("body").scrollTop($.cookie('tops'));
        document.body.scrollTop = $.cookie('tops');
    }

    $("a").click(function(){
        $.cookie('tops', 0, { expires: 1 });
    });

</script>
</body>

</html>
